(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(r){if(r.ep)return;r.ep=!0;const t=i(r);fetch(r.href,t)}})();function z(){const s=document.getElementById("country-name").textContent;s&&(window.location.href=`/journee.html?country=${encodeURIComponent(s)}`)}window.startSimulation=z;function U(){const c=Math.min(900,900)/2-60,r=d3.select("body").append("div").attr("class","tooltip").style("position","fixed").style("visibility","hidden").style("background","rgba(0, 0, 0, 0.9)").style("border","2px solid #38bdf8").style("border-radius","8px").style("padding","12px").style("font-family","'Press Start 2P', cursive").style("font-size","10px").style("color","white").style("pointer-events","none").style("z-index","9999").style("box-shadow","0 0 15px rgba(56, 189, 248, 0.3)"),t=d3.select("#circular-barplot").append("svg").attr("width",900).attr("height",900).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${900/2}, ${900/2})`),o=d3.scaleBand().range([0,2*Math.PI]).align(0).padding(.01),n=d3.scaleRadial().range([100,c]),d=d3.scaleOrdinal().range(["#FFF9DB","#FFE066","#FFA94D","#fb923c","#f97316","#ea580c","#c2410c"]);d3.json("./data/data.json").then(m=>{const v=Object.keys(m),p=["Eau et √©lectricit√©","Petit-d√©jeuner","Transport","Courses","Souper","Activit√©","Loyer"];d.domain(p);const h=v.map(e=>{const l={};return(m[e].activities||[]).forEach(u=>{if(u&&u.includes(":")){const[x,b]=u.split(": ");l[x]=+b.replace("‚Ç¨","")}}),{country:e,...l}});o.domain(h.map(e=>e.country)),n.domain([0,d3.max(h,e=>d3.sum(p,l=>e[l]||0))]);const N=d3.stack().keys(p)(h);t.append("circle").attr("r",c+20).attr("fill","rgba(255, 255, 255, 0.07)").attr("filter","url(#solar-glow)").lower();const I=t.append("defs").append("filter").attr("id","solar-glow");I.append("feGaussianBlur").attr("stdDeviation","5").attr("result","coloredBlur");const B=I.append("feMerge");B.append("feMergeNode").attr("in","coloredBlur"),B.append("feMergeNode").attr("in","SourceGraphic"),t.append("g").selectAll("g").data(N).join("g").attr("fill",e=>d(e.key)).selectAll("path").data(e=>e).join("path").attr("class","segment").attr("data-name",e=>e.data.country).attr("d",d3.arc().innerRadius(e=>n(e[0])).outerRadius(e=>n(e[1])).startAngle(e=>o(e.data.country)).endAngle(e=>o(e.data.country)+o.bandwidth()).padAngle(.01).padRadius(100)).style("stroke","#000").style("stroke-width","0.5px").style("stroke-opacity",.2).on("mouseover",function(e,l){const u=d3.select(this.parentNode).datum().key,x=l.data.country,b=(l[1]-l[0]).toFixed(2);d3.select(this).style("filter","brightness(1.2)").style("stroke-width","2px").style("stroke-opacity","1"),r.style("visibility","visible").html(`
            <div style="margin-bottom: 8px; color: #38bdf8">${x}</div>
            <div>${u}: ${b}‚Ç¨</div>
          `).style("left",e.clientX+15+"px").style("top",e.clientY-20+"px")}).on("mousemove",function(e){r.style("left",e.clientX+15+"px").style("top",e.clientY-20+"px")}).on("mouseout",function(){d3.select(this).style("filter","none").style("stroke-width","0.5px").style("stroke-opacity","0.2"),r.style("visibility","hidden")});const C=t.append("g").attr("text-anchor","middle"),R=n.ticks(6).filter(e=>e>0);C.selectAll("circle").data(R).join("circle").attr("fill","none").attr("stroke","#888").attr("stroke-width",1.2).attr("stroke-dasharray","2 2").attr("r",n),C.selectAll("text").data(R).join("text").attr("y",e=>-n(e)).attr("dy","0.35em").attr("fill","#fff").style("font-size","10px").text(n.tickFormat(5,"s"));const $=t.append("g").attr("transform","translate(0, 0)").selectAll("g").data(p.slice().reverse()).join("g").attr("transform",(e,l)=>`translate(-40, ${(l-p.length/2)*18})`).style("cursor","pointer").on("click",function(e,l){const u=t.selectAll("path"),x=u.style("opacity");u.style("opacity",.1),x==="0.1"?u.style("opacity",1):t.selectAll("path").filter(function(b){return d3.select(this.parentNode).datum().key===l}).style("opacity",1)});$.on("mouseover",function(){d3.select(this).style("opacity",.7)}).on("mouseout",function(){d3.select(this).style("opacity",1)}),$.append("rect").attr("width",12).attr("height",12).attr("fill",d),$.append("text").attr("x",16).attr("y",4).attr("dy","0.35em").style("font-size","8px").attr("fill","#fff").selectAll("tspan").data(e=>e==="Eau et √©lectricit√©"?["Eau et","√©lectricit√©"]:[e]).join("tspan").attr("x",16).attr("dy",(e,l)=>l===0?"0":"1.2em").text(e=>e);const O=document.getElementById("circular-search");O.addEventListener("input",()=>{const e=O.value.toLowerCase();t.selectAll("path").style("opacity",1).style("filter","none"),e&&(t.selectAll("path").style("opacity",.2),t.selectAll("path").filter(function(){var u;const l=(u=d3.select(this).attr("data-name"))==null?void 0:u.toLowerCase();return l&&l.includes(e)}).style("opacity",1).style("filter","brightness(1.2)"))})})}U();const w=d3.select("#map"),L=1300,A=800;w.attr("width",L).attr("height",A).attr("viewBox",`0 0 ${L} ${A}`).attr("preserveAspectRatio","xMidYMid meet");const P=d3.geoMercator().scale(180).center([0,30]).translate([L/2,A/2]),X=d3.geoPath().projection(P);let y=[],M=null;const f=document.getElementById("character"),k=document.getElementById("rocket"),Y={1:"avatar1.gif",2:"avatar2.png",3:"avatar3.webp"};document.querySelectorAll(".character-option").forEach(s=>{s.addEventListener("click",()=>{document.querySelectorAll(".character-option").forEach(i=>i.classList.remove("selected")),s.classList.add("selected");const a=s.dataset.character;M=a,f.src=`./data/assets/${Y[a]}`,f.classList.remove("hidden"),f.onload=()=>{H()}})});function H(){const s=k.getBoundingClientRect(),a=document.getElementById("map-container").getBoundingClientRect(),i=f.offsetWidth||50,c=s.left-a.left,r=s.top-a.top;f.style.left=`${c+s.width/2-i/2}px`,f.style.top=`${r+s.height/2-i/2}px`,f.style.position="absolute",f.style.transition="all 0.4s ease"}Promise.all([d3.json("https://unpkg.com/world-atlas@2/countries-110m.json"),d3.json("../../data/data.json")]).then(([s,a])=>{const i={Japan:"Japan",France:"France"},c=topojson.feature(s,s.objects.countries).features;w.selectAll("path").data(c).join("path").attr("class","map-path").attr("d",X).attr("fill",t=>{const o=i[t.properties.name]||t.properties.name;return a[o]?"#3b82f6":"#1111aa"}).attr("stroke","#000033").attr("stroke-width",.5).on("mouseover",function(){d3.select(this).attr("fill","#ff00cc")}).on("mouseout",function(t,o){const n=i[o.properties.name]||o.properties.name;y.includes(n)||d3.select(this).attr("fill",a[n]?"#3b82f6":"#1111aa"),d3.select("#tooltip").classed("hidden",!0)}).on("mousemove",function(t,o){var m;const n=i[o.properties.name]||o.properties.name,d=((m=a[n])==null?void 0:m.cost)??"Donn√©es indisponibles";d3.select("#tooltip").style("left",`${t.pageX+15}px`).style("top",`${t.pageY-40}px`).html(`
          <div class="tooltip-title">${n}</div>
          <div class="tooltip-cost">${d} / jour</div>
        `).classed("hidden",!1)}).on("click",function(t,o){t.stopPropagation();const n=i[o.properties.name]||o.properties.name;if(!a[n])return;y.includes(n)?(y=y.filter(p=>p!==n),d3.select(this).attr("fill","#3b82f6")):y.length<2&&(y.push(n),d3.select(this).attr("fill","#ff00cc"));const[d,m]=P(d3.geoCentroid(o));if(k&&(k.style.left=`${d}px`,k.style.top=`${m}px`),M){f.classList.remove("hidden");const p=30,h=20;f.style.left=`${d-p}px`,f.style.top=`${m-h}px`}const v=document.getElementById("country-info");if(v.classList.remove("hidden"),document.getElementById("day-simulation").classList.add("hidden"),y.length===2){const[p,h]=y;v.innerHTML=`
          <h2 class="text-xl mb-4 text-pink-400">Comparaison</h2>
          <p class="mb-4">Tu as s√©lectionn√© <span class="text-yellow-300">${p}</span> et <span class="text-yellow-300">${h}</span>.</p>
          <p class="mb-4">Souhaites-tu les comparer ?</p>
          <button id="confirm-compare" onclick="compareSelectedCountries()">VOIR LA COMPARAISON</button>
        `,setTimeout(()=>{document.getElementById("confirm-compare").addEventListener("click",()=>{window.location.href=`compare.html?country1=${encodeURIComponent(p)}&country2=${encodeURIComponent(h)}`})},50)}else v.innerHTML=`
          <h2 id="country-name">${n}</h2>
          <p id="daily-cost">Co√ªt moyen par jour : ${a[n].cost}</p>
          <button onclick="startSimulation()">VOIR UNE JOURN√âE TYPE</button>
        `}),w.on("click",function(t){if(t.target.tagName!=="path"){y=[],w.selectAll(".map-path").attr("fill",n=>{const d=i[n.properties.name]||n.properties.name;return a[d]?"#3b82f6":"#1111aa"});const o=document.getElementById("country-info");o.classList.add("hidden"),o.innerHTML=`
        <h2 id="country-name">Pays</h2>
        <p id="daily-cost">Co√ªt moyen par jour : XX‚Ç¨</p>
        <button onclick="startSimulation()">VOIR UNE JOURN√âE TYPE</button>
      `}});function r(){const t=d3.select("#map-container").append("div").attr("class","map-instructions").style("position","absolute").style("top","10px").style("left","50%").style("transform","translateX(-50%)").style("text-align","center").style("background","rgba(0,0,0,0.8)").style("padding","10px").style("border-radius","8px").style("border","2px solid #38bdf8").style("pointer-events","none");t.html(`
      <p>üåü Cliquez sur un pays pour d√©couvrir une journ√©e type</p>
      <p>‚ú® Ou s√©lectionnez deux pays pour les comparer !</p>
    `),d3.selectAll(".map-path").on("click.instructions",function(){t.remove(),d3.selectAll(".map-path").on("click.instructions",null)})}r()});let S={},E=[],F=[],j=[],g=!1;fetch("./data/data.json").then(s=>s.json()).then(s=>{S=s;const a=Object.entries(s).map(([i,c])=>({name:i,value:parseFloat(c.cost.replace("‚Ç¨",""))}));a.sort((i,c)=>c.value-i.value),E=a.slice(0,3),F=a.slice(-3),j=E,d3.select("#cockpit-chart").append("svg").attr("width",300).attr("height",300).style("overflow","visible"),T()});function T(s="#38bdf8"){const a=d3.select("#cockpit-chart svg g");a.empty()||a.remove();const t=d3.select("#cockpit-chart svg").append("g").attr("transform",`translate(${300/2}, ${300/2})`);t.append("ellipse").attr("rx",170).attr("ry",75).attr("fill","#0a0a3d").style("filter",`drop-shadow(0 0 15px ${s})`),t.append("ellipse").attr("cy",-40).attr("rx",90).attr("ry",40).attr("fill",s).attr("opacity",.3),t.append("line").attr("x1",0).attr("y1",-70).attr("x2",0).attr("y2",-100).attr("stroke",s).attr("stroke-width",2),t.append("circle").attr("cx",0).attr("cy",-100).attr("r",5).attr("fill",s),t.append("ellipse").attr("rx",140).attr("ry",60).attr("stroke",s).attr("fill","none").attr("stroke-width",2).attr("stroke-dasharray","5 5");const o=t.append("g").attr("text-anchor","middle").attr("transform","translate(0, 0)").selectAll("text").data(j).enter().append("text").attr("class","country-name-radar").attr("y",(n,d)=>d*25-25).text(n=>`${n.name} (${n.value}‚Ç¨)`).attr("fill","#fff").attr("font-size","12px").style("font-family","'Press Start 2P', cursive").style("cursor","pointer");o.style("opacity",0).transition().duration(500).delay((n,d)=>d*200).style("opacity",1).on("end",function(){d3.select(this).classed("pulse",!0)}),o.on("mouseover",function(){d3.select(this).transition().duration(200).attr("fill",s).attr("font-size","14px")}).on("mouseout",function(){d3.select(this).transition().duration(200).attr("fill","#fff").attr("font-size","12px")}).on("click",function(n,d){d3.select(this).transition().duration(100).attr("fill","#facc15").transition().duration(500).attr("fill",s),V(d.name)})}function V(s){const a=S[s],i=document.getElementById("activityDetails");if(!a){i.innerHTML=`<p style="color:red;">Pays non trouv√© : ${s}</p>`;return}const c=g?"rose-style":"bleu-style";i.classList.remove("rose-style","bleu-style"),i.classList.add(c);const r=a.activities.filter(Boolean),t=`
    <h3>${s}</h3>
    <ul>
      ${r.map(o=>`<li>${o}</li>`).join("")}
    </ul>
  `;i.innerHTML=t}document.getElementById("toggleView").addEventListener("click",()=>{g=!g,j=g?F:E,T(g?"#f472b6":"#38bdf8");const s=document.getElementById("toggleView");s.classList.toggle("low",g),s.innerText=g?"Les 3 pays les moins chers":"Les 3 pays les plus chers"});
